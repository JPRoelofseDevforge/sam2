import{j as e,u as w}from"./index-436f242b.js";import{g as S,a as y,b as C,u as T}from"./athleteUtils-be02baea.js";import{r as x}from"./vendor-c778fe58.js";import{w as F,g as u,a as A,b as R}from"./weatherUtils-fe320b1d.js";import{g as _,c as E}from"./analytics-f7964037.js";import"./three-83fa84b5.js";const I={}.VITE_CITY||"Stellenbosch",$={}.VITE_STATE||"Western Cape",q={}.VITE_COUNTRY||"South Africa",D=(s=3e5)=>{const[d,l]=x.useState(null),[m,c]=x.useState(!0),[i,a]=x.useState(null),o=async()=>{try{c(!0),a(null);const r=await F.getCurrentWeather(I,$,q);if(!r.success||!r.data)throw new Error(r.error||r.message||"Failed to fetch air quality data");const h=r.data;l({temperature:h.current?.temperature||0,humidity:h.current?.humidity||0,aqi:h.current?.air_quality_index||0,co:0,pm25:0,pm10:0,windSpeed:h.current?.wind_speed||0,pressure:h.current?.pressure||0,weatherCondition:h.current?.weather_condition||"Unknown",lastUpdated:new Date().toLocaleTimeString()})}catch(r){l({temperature:22,humidity:60,aqi:25,co:0,pm25:0,pm10:0,windSpeed:5,pressure:1013,weatherCondition:"Partly Cloudy",lastUpdated:new Date().toLocaleTimeString()}),a(r.message||"Failed to fetch weather data")}finally{c(!1)}};return x.useEffect(()=>{o();const r=setInterval(o,s);return()=>clearInterval(r)},[s]),{airQuality:d,loading:m,error:i,refetch:o}},V=({airQuality:s,city:d,formattedDate:l})=>e.jsxs("section",{className:"weather-card-enhanced",children:[e.jsxs("div",{className:"weather-header",children:[e.jsxs("div",{className:"weather-header-left",children:[e.jsxs("div",{className:"weather-indicator",children:[e.jsx("div",{className:"indicator-pulse"}),e.jsx("div",{className:"indicator-dot-enhanced"})]}),e.jsxs("div",{className:"weather-title-section",children:[e.jsx("h2",{className:"weather-main-title",children:"Environmental Health"}),e.jsxs("p",{className:"weather-subtitle",children:[d," • ",l]})]})]}),e.jsxs("div",{className:"weather-status-badge",children:[e.jsx("span",{className:"status-live",children:"● LIVE"}),e.jsx("span",{className:"status-text",children:"Real-time Data"})]})]}),e.jsxs("div",{className:"weather-metrics-container",children:[e.jsxs("div",{className:"metrics-primary-grid",children:[e.jsxs("div",{className:"metric-featured metric-temperature",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌡️"}),e.jsx("div",{className:"metric-glow-effect"})]}),e.jsxs("div",{className:"metric-content",children:[e.jsxs("div",{className:"metric-value-featured temp-value-enhanced",children:[s?.temperature||"--",e.jsx("span",{className:"metric-unit",children:"°C"})]}),e.jsx("div",{className:"metric-label-enhanced",children:"Temperature"}),e.jsxs("div",{className:"metric-trend",children:[e.jsx("span",{className:"trend-indicator",children:"↗"}),e.jsx("span",{className:"trend-text",children:"Optimal Range"})]})]})]}),e.jsxs("div",{className:"metric-featured metric-aqi",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌫️"}),e.jsx("div",{className:`aqi-glow ${u(s?.aqi||0).class}`})]}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:`metric-value-featured aqi-value-enhanced ${u(s?.aqi||0).class}`,children:s?.aqi||"--"}),e.jsx("div",{className:"metric-label-enhanced",children:"Air Quality Index"}),e.jsx("div",{className:"metric-badge",children:e.jsx("span",{className:`aqi-badge ${u(s?.aqi||0).class}`,children:u(s?.aqi||0).label})})]})]})]}),e.jsxs("div",{className:"metrics-secondary-grid",children:[e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💧"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small humidity-value-enhanced",children:[s?.humidity||"--","%"]}),e.jsx("div",{className:"metric-label-small",children:"Humidity"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress humidity-progress",style:{width:`${s?.humidity||0}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💨"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small wind-value-enhanced",children:[s?.windSpeed||"--"," km/h"]}),e.jsx("div",{className:"metric-label-small",children:"Wind Speed"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress wind-progress",style:{width:`${Math.min((s?.windSpeed||0)*5,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"🔽"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small pressure-value-enhanced",children:[s?.pressure||"--"," hPa"]}),e.jsx("div",{className:"metric-label-small",children:"Pressure"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress pressure-progress",style:{width:`${Math.min((s?.pressure||0)/10,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:A(s?.weatherCondition)}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-value-small condition-value-enhanced",children:R(s?.weatherCondition)}),e.jsx("div",{className:"metric-label-small",children:"Conditions"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress condition-progress"})})]})]})]}),e.jsxs("div",{className:"weather-footer",children:[e.jsxs("div",{className:"update-info",children:[e.jsx("span",{className:"update-icon",children:"⏱️"}),e.jsxs("span",{className:"update-text",children:["Last updated: ",s?.lastUpdated||"—"]})]}),e.jsx("div",{className:"refresh-info",children:e.jsx("span",{className:"refresh-badge",children:"Auto-refresh: 5 min"})})]})]}),k=({athletes:s,biometricData:d,geneticProfiles:l,onAthleteClick:m})=>{const c=x.useMemo(()=>{const i=(s||[]).map(t=>{const{data:n,genetics:p}=S(t.athlete_id,d,l),g=n&&n.length>0?n[0]:null,f=_(t.athlete_id,n,p),b=n.length>0?E(n[n.length-1]):0;return{athlete:t,latest:g,alert:f,readinessScore:b}}),a=i.filter(t=>t.latest),o=a.length>0?a.reduce((t,n)=>t+(n.latest?.hrv_night||0),0)/a.length:0,r=a.length>0?a.reduce((t,n)=>t+(n.latest?.sleep_duration_h||0),0)/a.length:0,h=a.length>0?a.reduce((t,n)=>t+n.readinessScore,0)/a.length:0,N={high:i.filter(t=>["inflammation","airway"].includes(t.alert.type)).length,medium:i.filter(t=>["circadian","nutrition"].includes(t.alert.type)).length,optimal:i.filter(t=>t.alert.type==="green").length};return{totalAthletes:(s||[]).length,avgHRV:o||0,avgSleep:r||0,avgReadiness:h||0,alertCounts:N,athleteMetrics:i}},[s,d,l]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid-wide",children:[e.jsx(j,{label:"Athletes",value:c.totalAthletes,icon:"👥",color:"blue"}),e.jsx(j,{label:"Avg HRV",value:`${c.avgHRV.toFixed(0)} ms`,icon:"❤️",color:"purple"}),e.jsx(j,{label:"Avg Sleep",value:`${c.avgSleep.toFixed(1)}h`,icon:"😴",color:"indigo"}),e.jsx(j,{label:"Readiness",value:`${c.avgReadiness.toFixed(0)}%`,icon:"⚡",color:"orange"})]}),e.jsxs("div",{className:"alerts-grid",children:[e.jsx(v,{title:"High Priority",count:c.alertCounts.high,icon:"🔴",color:"red",desc:"Immediate attention"}),e.jsx(v,{title:"Monitor",count:c.alertCounts.medium,icon:"🟡",color:"yellow",desc:"Potential issues"}),e.jsx(v,{title:"Optimal",count:c.alertCounts.optimal,icon:"🟢",color:"green",desc:"Ready for training"})]}),e.jsxs("section",{className:"athletes-section",children:[e.jsx("h2",{className:"section-title text-white",children:"👥 Athlete Status"}),e.jsx("div",{className:"athletes-grid",children:c.athleteMetrics?.map(({athlete:i,latest:a,alert:o,readinessScore:r},h)=>e.jsxs("div",{className:`athlete-card ${y(o.type)} card-hover`,onClick:()=>m(i.id.toString()),children:[e.jsxs("div",{className:"athlete-header",children:[e.jsxs("div",{className:"athlete-info",children:[e.jsx("h3",{className:"athlete-name",children:i.name}),e.jsxs("p",{className:"athlete-meta",children:[i.sport," • ",i.age," • ",i.team]})]}),e.jsx("div",{className:"alert-icon",children:C(o.type)})]}),e.jsxs("div",{className:"athlete-metrics",children:[e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"HRV"}),e.jsx("span",{className:"value",children:a?.hrv_night?a.hrv_night.toFixed(0)+" ms":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Sleep"}),e.jsx("span",{className:"value",children:a?.sleep_duration_h?a.sleep_duration_h.toFixed(1)+"h":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"RHR"}),e.jsx("span",{className:"value",children:a?.resting_hr?a.resting_hr.toFixed(0)+" bpm":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Ready"}),e.jsxs("span",{className:"value",children:[r.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"athlete-alert",children:[e.jsx("p",{className:"alert-title",children:o.title.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu,"").trim()}),e.jsx("p",{className:"alert-cause",children:o.cause})]}),e.jsx("button",{className:"profile-button",children:"📊 Open Profile"})]},i.id||h))})]})]})},j=({label:s,value:d,icon:l,color:m})=>e.jsxs("div",{className:"card-enhanced p-5 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:l}),e.jsx("div",{className:"text-2xl font-bold text-black",children:d}),e.jsx("div",{className:"text-gray-700 text-sm mt-1 font-medium",children:s})]}),v=({title:s,count:d,icon:l,color:m,desc:c})=>e.jsxs("div",{className:`card-enhanced border-${m}-200 bg-${m}-50 p-5 hover:shadow-lg transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:l}),e.jsx("h3",{className:`text-lg font-bold text-${m}-700`,children:s})]}),e.jsx("div",{className:`text-3xl font-bold text-${m}-700 mb-2`,children:d}),e.jsx("p",{className:`text-sm text-${m}-600`,children:c})]}),L={CITY:{}.VITE_CITY||"Stellenbosch",STATE:{}.VITE_STATE||"Western Cape",COUNTRY:{}.VITE_COUNTRY||"South Africa",REFRESH_INTERVAL:3e5},H=()=>new Date().toLocaleDateString("en-ZA",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),B=()=>{const s=w(),{athletes:d,biometricData:l,geneticProfiles:m,loading:c}=T(!0),{airQuality:i}=D(),a=H(),o=r=>{s(`/athlete/${r}`)};return c?e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsx("div",{className:"main-content",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-white text-2xl",children:"Loading athlete data..."})})})]}):e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsxs("div",{className:"main-content",children:[e.jsxs("header",{className:"header-section",children:[e.jsx("h1",{className:"logo-text",children:e.jsx("img",{src:"/SAMLogo.png",alt:"SAM Recovery Logo",className:"h-8 md:h-10 lg:h-12 w-auto object-contain"})}),e.jsx("p",{className:"tagline",children:"Precision Recovery Through Genetics × Biometrics × Environment"})]}),e.jsx(V,{airQuality:i,city:L.CITY,formattedDate:a}),e.jsx(k,{athletes:d,biometricData:l,geneticProfiles:m,onAthleteClick:o})]})]})};export{B as TeamOverview};
