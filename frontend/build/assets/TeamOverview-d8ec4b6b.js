import{j as e,h as q,u as F}from"./index-2fe32897.js";import{g as V,a as k,b as Y,u as O}from"./athleteUtils-f52ec51e.js";import{r as w,c as _}from"./vendor-26c3c1d8.js";import{w as W,g as S,a as P,b as U}from"./weatherUtils-fe320b1d.js";import{g as B,c as G}from"./analytics-ac2fb86e.js";import"./three-f2a0a5ce.js";const Z={}.VITE_CITY||"Stellenbosch",z={}.VITE_STATE||"Western Cape",J={}.VITE_COUNTRY||"South Africa",K=(s=3e5)=>{const[r,l]=w.useState(null),[d,o]=w.useState(!0),[j,c]=w.useState(null),i=async()=>{try{o(!0),c(null);const a=await W.getCurrentWeather(Z,z,J);if(!a.success||!a.data)throw new Error(a.error||a.message||"Failed to fetch air quality data");const m=a.data;l({temperature:m.current?.temperature||0,humidity:m.current?.humidity||0,aqi:m.current?.air_quality_index||0,co:0,pm25:0,pm10:0,windSpeed:m.current?.wind_speed||0,pressure:m.current?.pressure||0,weatherCondition:m.current?.weather_condition||"Unknown",lastUpdated:new Date().toLocaleTimeString()})}catch(a){l({temperature:22,humidity:60,aqi:25,co:0,pm25:0,pm10:0,windSpeed:5,pressure:1013,weatherCondition:"Partly Cloudy",lastUpdated:new Date().toLocaleTimeString()}),c(a.message||"Failed to fetch weather data")}finally{o(!1)}};return w.useEffect(()=>{i();const a=setInterval(i,s);return()=>clearInterval(a)},[s]),{airQuality:r,loading:d,error:j,refetch:i}},X=({airQuality:s,city:r,formattedDate:l})=>e.jsxs("section",{className:"weather-card-enhanced",children:[e.jsxs("div",{className:"weather-header",children:[e.jsxs("div",{className:"weather-header-left",children:[e.jsxs("div",{className:"weather-indicator",children:[e.jsx("div",{className:"indicator-pulse"}),e.jsx("div",{className:"indicator-dot-enhanced"})]}),e.jsxs("div",{className:"weather-title-section",children:[e.jsx("h2",{className:"weather-main-title",children:"Environmental Health"}),e.jsxs("p",{className:"weather-subtitle",children:[r," • ",l]})]})]}),e.jsxs("div",{className:"weather-status-badge",children:[e.jsx("span",{className:"status-live",children:"● LIVE"}),e.jsx("span",{className:"status-text",children:"Real-time Data"})]})]}),e.jsxs("div",{className:"weather-metrics-container",children:[e.jsxs("div",{className:"metrics-primary-grid",children:[e.jsxs("div",{className:"metric-featured metric-temperature",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌡️"}),e.jsx("div",{className:"metric-glow-effect"})]}),e.jsxs("div",{className:"metric-content",children:[e.jsxs("div",{className:"metric-value-featured temp-value-enhanced",children:[s?.temperature||"--",e.jsx("span",{className:"metric-unit",children:"°C"})]}),e.jsx("div",{className:"metric-label-enhanced",children:"Temperature"}),e.jsxs("div",{className:"metric-trend",children:[e.jsx("span",{className:"trend-indicator",children:"↗"}),e.jsx("span",{className:"trend-text",children:"Optimal Range"})]})]})]}),e.jsxs("div",{className:"metric-featured metric-aqi",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌫️"}),e.jsx("div",{className:`aqi-glow ${S(s?.aqi||0).class}`})]}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:`metric-value-featured aqi-value-enhanced ${S(s?.aqi||0).class}`,children:s?.aqi||"--"}),e.jsx("div",{className:"metric-label-enhanced",children:"Air Quality Index"}),e.jsx("div",{className:"metric-badge",children:e.jsx("span",{className:`aqi-badge ${S(s?.aqi||0).class}`,children:S(s?.aqi||0).label})})]})]})]}),e.jsxs("div",{className:"metrics-secondary-grid",children:[e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💧"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small humidity-value-enhanced",children:[s?.humidity||"--","%"]}),e.jsx("div",{className:"metric-label-small",children:"Humidity"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress humidity-progress",style:{width:`${s?.humidity||0}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💨"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small wind-value-enhanced",children:[s?.windSpeed||"--"," km/h"]}),e.jsx("div",{className:"metric-label-small",children:"Wind Speed"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress wind-progress",style:{width:`${Math.min((s?.windSpeed||0)*5,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"🔽"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small pressure-value-enhanced",children:[s?.pressure||"--"," hPa"]}),e.jsx("div",{className:"metric-label-small",children:"Pressure"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress pressure-progress",style:{width:`${Math.min((s?.pressure||0)/10,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:P(s?.weatherCondition)}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-value-small condition-value-enhanced",children:U(s?.weatherCondition)}),e.jsx("div",{className:"metric-label-small",children:"Conditions"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress condition-progress"})})]})]})]}),e.jsxs("div",{className:"weather-footer",children:[e.jsxs("div",{className:"update-info",children:[e.jsx("span",{className:"update-icon",children:"⏱️"}),e.jsxs("span",{className:"update-text",children:["Last updated: ",s?.lastUpdated||"—"]})]}),e.jsx("div",{className:"refresh-info",children:e.jsx("span",{className:"refresh-badge",children:"Auto-refresh: 5 min"})})]})]}),C=s=>{if(!s)return null;const r=new Date(s);if(isNaN(r.getTime()))return null;const l=new Date,d=o=>new Date(o.getFullYear(),o.getMonth(),o.getDate());return Math.floor((d(l).getTime()-d(r).getTime())/(24*60*60*1e3))},Q=s=>{const r=C(s);return r===null?"!bg-gray-50":r<=0?"!bg-green-100":r<=3?"!bg-orange-50":"!bg-red-50"},ee=s=>{const r=C(s);return r===null?"!bg-gray-50 text-gray-700 px-2 py-1":r<=0?"!bg-green-200 !text-green-800 px-2 py-1":r<=3?"!bg-orange-200 !text-orange-800 px-2 py-1":"!bg-red-300 !text-red-800 px-2 py-1"},se=({athletes:s,biometricData:r,geneticProfiles:l,onAthleteClick:d})=>{const[o,j]=_.useState({});_.useEffect(()=>{(async()=>{const a={};for(const m of s)try{const u=await q.getHeartRateData(parseInt(m.athlete_id));a[m.athlete_id]=u}catch{a[m.athlete_id]=[]}j(a)})()},[s]);const c=w.useMemo(()=>{const i=(s||[]).map(t=>{const{data:n,genetics:R}=V(t.athlete_id,r,l),A=n&&n.length>0?n[0]:null,E=B(t.athlete_id,n,R),I=(()=>{for(const h of n){const x=G(h);if(x>0)return x}return 0})(),$=(()=>{if(!Array.isArray(n)||n.length===0)return 0;const h=new Date;h.setDate(h.getDate()-1);const x=h.toISOString().split("T")[0];return n.find(y=>y.date===x)?.sleep_duration_h||0})(),H=n.filter(h=>h.avg_heart_rate&&h.avg_heart_rate>0||h.resting_hr&&h.resting_hr>0).sort((h,x)=>new Date(x.date).getTime()-new Date(h.date).getTime())[0]?.date||null,L=(()=>{const h=n.filter(g=>g.sleep_duration_h&&g.sleep_duration_h>0);if(h.length===0)return null;const x=h.sort((g,v)=>new Date(v.date).getTime()-new Date(g.date).getTime())[0],T=new Date(x.date),y=o[t.athlete_id]||[];if(y.length>0){const g=y.map(v=>({...v,timeDiff:Math.abs(v.measuredAt.getTime()-T.getTime())})).sort((v,M)=>v.timeDiff-M.timeDiff)[0];if(g.timeDiff<2*60*60*1e3)return g.heartRateBPM}return x.avg_heart_rate||x.resting_hr||null})();return{athlete:t,latest:A,alert:E,readinessScore:I,computedSleepH:$,lastSyncedDate:H,rhr:L}}),a=i.filter(t=>t.latest),m=a.length>0?a.reduce((t,n)=>t+(n.latest?.hrv_night||0),0)/a.length:0,u=a.length>0?a.reduce((t,n)=>t+(n.computedSleepH||0),0)/a.length:0,N=a.length>0?a.reduce((t,n)=>t+n.readinessScore,0)/a.length:0,p={high:i.filter(t=>["inflammation","airway"].includes(t.alert.type)).length,medium:i.filter(t=>["circadian","nutrition"].includes(t.alert.type)).length,optimal:i.filter(t=>t.alert.type==="green").length},b=r.filter(t=>t.avg_heart_rate&&t.avg_heart_rate>0||t.resting_hr&&t.resting_hr>0).sort((t,n)=>new Date(n.date).getTime()-new Date(t.date).getTime())[0]?.date||null;return{totalAthletes:(s||[]).length,avgHRV:m||0,avgSleep:u||0,avgReadiness:N||0,lastSyncedDate:b,alertCounts:p,athleteMetrics:i}},[s,r,l,o]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid-wide",children:[e.jsx(f,{label:"Athletes",value:c.totalAthletes,icon:"👥",color:"blue"}),e.jsx(f,{label:"Avg HRV",value:`${c.avgHRV.toFixed(0)} ms`,icon:"❤️",color:"purple"}),e.jsx(f,{label:"Avg Sleep",value:`${c.avgSleep.toFixed(1)}h`,icon:"😴",color:"indigo"}),e.jsx(f,{label:"Readiness",value:`${c.avgReadiness.toFixed(0)}%`,icon:"⚡",color:"orange"}),e.jsx(f,{label:"Last Synced",value:c.lastSyncedDate?new Date(c.lastSyncedDate).toLocaleDateString():"N/A",icon:"🔄",color:"green",containerClassName:Q(c.lastSyncedDate)})]}),e.jsxs("div",{className:"alerts-grid",children:[e.jsx(D,{title:"High Priority",count:c.alertCounts.high,icon:"🔴",color:"red",desc:"Immediate attention"}),e.jsx(D,{title:"Monitor",count:c.alertCounts.medium,icon:"🟡",color:"yellow",desc:"Potential issues"}),e.jsx(D,{title:"Optimal",count:c.alertCounts.optimal,icon:"🟢",color:"green",desc:"Ready for training"})]}),e.jsx("section",{className:"athletes-section",children:e.jsx("div",{className:"athletes-grid",children:c.athleteMetrics?.map(({athlete:i,latest:a,alert:m,readinessScore:u,computedSleepH:N,lastSyncedDate:p,rhr:b},t)=>e.jsxs("div",{className:`athlete-card ${k(m.type)} card-hover`,onClick:()=>d(i.id.toString()),children:[e.jsxs("div",{className:"athlete-header",children:[e.jsxs("div",{className:"athlete-info",children:[e.jsx("h3",{className:"athlete-name",children:i.name}),e.jsxs("p",{className:"athlete-meta",children:[i.sport," • ",i.age," • ",i.team]})]}),e.jsx("div",{className:"alert-icon",children:Y(m.type)})]}),e.jsxs("div",{className:"athlete-metrics",children:[e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"HRV"}),e.jsx("span",{className:"value",children:a?.hrv_night?a.hrv_night.toFixed(0)+" ms":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Sleep"}),e.jsx("span",{className:"value",children:N&&N>0?N.toFixed(1)+"h":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"RHR"}),e.jsx("span",{className:"value",children:b?`${b.toFixed(0)} bpm`:"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Ready"}),e.jsxs("span",{className:"value",children:[u.toFixed(0),"%"]})]}),e.jsxs("div",{className:`metric-pair rounded-md ${ee(p)}`,children:[e.jsx("span",{className:"label",children:"Last Synced"}),e.jsx("span",{className:"value",children:p?new Date(p).toLocaleDateString():"N/A"})]})]}),e.jsx("button",{className:"profile-button",children:"📊 Open Profile"})]},i.id||t))})})]})},f=({label:s,value:r,icon:l,color:d,containerClassName:o})=>e.jsxs("div",{className:`card-enhanced p-5 text-center ${o||""}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:l}),e.jsx("div",{className:"text-2xl font-bold text-black",children:r}),e.jsx("div",{className:"text-gray-700 text-sm mt-1 font-medium",children:s})]}),D=({title:s,count:r,icon:l,color:d,desc:o})=>e.jsxs("div",{className:`card-enhanced border-${d}-200 bg-${d}-50 p-5 hover:shadow-lg transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:l}),e.jsx("h3",{className:`text-lg font-bold text-${d}-700`,children:s})]}),e.jsx("div",{className:`text-3xl font-bold text-${d}-700 mb-2`,children:r}),e.jsx("p",{className:`text-sm text-${d}-600`,children:o})]}),ae={CITY:{}.VITE_CITY||"Stellenbosch",STATE:{}.VITE_STATE||"Western Cape",COUNTRY:{}.VITE_COUNTRY||"South Africa",REFRESH_INTERVAL:3e5},te=()=>new Date().toLocaleDateString("en-ZA",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),oe=()=>{const s=F(),{athletes:r,biometricData:l,geneticProfiles:d,loading:o}=O(!0),{airQuality:j}=K(),c=te(),i=a=>{s(`/athlete/${a}`)};return o?e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsx("div",{className:"main-content",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-white text-2xl",children:"Loading athlete data..."})})})]}):e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsxs("div",{className:"main-content",children:[e.jsxs("header",{className:"header-section",children:[e.jsx("h1",{className:"logo-text",children:e.jsx("img",{src:"/SAMLogo.png",alt:"SAM Recovery Logo",className:"h-8 md:h-10 lg:h-12 w-auto object-contain"})}),e.jsx("p",{className:"tagline",children:"Precision Recovery Through Genetics × Biometrics × Environment"})]}),e.jsx(X,{airQuality:j,city:ae.CITY,formattedDate:c}),e.jsx(se,{athletes:r,biometricData:l,geneticProfiles:d,onAthleteClick:i})]})]})};export{oe as TeamOverview};
