import{j as e,u as T}from"./index-dea40677.js";import{g as C,a as F,b as A,u as R}from"./athleteUtils-dce2dd12.js";import{r as x}from"./vendor-c778fe58.js";import{w as E,g as u,a as I,b as _}from"./weatherUtils-fe320b1d.js";import{g as $,c as D}from"./analytics-f7964037.js";import"./three-f2a0a5ce.js";const q={}.VITE_CITY||"Stellenbosch",k={}.VITE_STATE||"Western Cape",L={}.VITE_COUNTRY||"South Africa",V=(s=3e5)=>{const[i,a]=x.useState(null),[t,l]=x.useState(!0),[c,r]=x.useState(null),o=async()=>{try{l(!0),r(null);const d=await E.getCurrentWeather(q,k,L);if(!d.success||!d.data)throw new Error(d.error||d.message||"Failed to fetch air quality data");const h=d.data;a({temperature:h.current?.temperature||0,humidity:h.current?.humidity||0,aqi:h.current?.air_quality_index||0,co:0,pm25:0,pm10:0,windSpeed:h.current?.wind_speed||0,pressure:h.current?.pressure||0,weatherCondition:h.current?.weather_condition||"Unknown",lastUpdated:new Date().toLocaleTimeString()})}catch(d){a({temperature:22,humidity:60,aqi:25,co:0,pm25:0,pm10:0,windSpeed:5,pressure:1013,weatherCondition:"Partly Cloudy",lastUpdated:new Date().toLocaleTimeString()}),r(d.message||"Failed to fetch weather data")}finally{l(!1)}};return x.useEffect(()=>{o();const d=setInterval(o,s);return()=>clearInterval(d)},[s]),{airQuality:i,loading:t,error:c,refetch:o}},H=({airQuality:s,city:i,formattedDate:a})=>e.jsxs("section",{className:"weather-card-enhanced",children:[e.jsxs("div",{className:"weather-header",children:[e.jsxs("div",{className:"weather-header-left",children:[e.jsxs("div",{className:"weather-indicator",children:[e.jsx("div",{className:"indicator-pulse"}),e.jsx("div",{className:"indicator-dot-enhanced"})]}),e.jsxs("div",{className:"weather-title-section",children:[e.jsx("h2",{className:"weather-main-title",children:"Environmental Health"}),e.jsxs("p",{className:"weather-subtitle",children:[i," • ",a]})]})]}),e.jsxs("div",{className:"weather-status-badge",children:[e.jsx("span",{className:"status-live",children:"● LIVE"}),e.jsx("span",{className:"status-text",children:"Real-time Data"})]})]}),e.jsxs("div",{className:"weather-metrics-container",children:[e.jsxs("div",{className:"metrics-primary-grid",children:[e.jsxs("div",{className:"metric-featured metric-temperature",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌡️"}),e.jsx("div",{className:"metric-glow-effect"})]}),e.jsxs("div",{className:"metric-content",children:[e.jsxs("div",{className:"metric-value-featured temp-value-enhanced",children:[s?.temperature||"--",e.jsx("span",{className:"metric-unit",children:"°C"})]}),e.jsx("div",{className:"metric-label-enhanced",children:"Temperature"}),e.jsxs("div",{className:"metric-trend",children:[e.jsx("span",{className:"trend-indicator",children:"↗"}),e.jsx("span",{className:"trend-text",children:"Optimal Range"})]})]})]}),e.jsxs("div",{className:"metric-featured metric-aqi",children:[e.jsxs("div",{className:"metric-icon-container",children:[e.jsx("span",{className:"metric-icon-large",children:"🌫️"}),e.jsx("div",{className:`aqi-glow ${u(s?.aqi||0).class}`})]}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:`metric-value-featured aqi-value-enhanced ${u(s?.aqi||0).class}`,children:s?.aqi||"--"}),e.jsx("div",{className:"metric-label-enhanced",children:"Air Quality Index"}),e.jsx("div",{className:"metric-badge",children:e.jsx("span",{className:`aqi-badge ${u(s?.aqi||0).class}`,children:u(s?.aqi||0).label})})]})]})]}),e.jsxs("div",{className:"metrics-secondary-grid",children:[e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💧"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small humidity-value-enhanced",children:[s?.humidity||"--","%"]}),e.jsx("div",{className:"metric-label-small",children:"Humidity"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress humidity-progress",style:{width:`${s?.humidity||0}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"💨"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small wind-value-enhanced",children:[s?.windSpeed||"--"," km/h"]}),e.jsx("div",{className:"metric-label-small",children:"Wind Speed"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress wind-progress",style:{width:`${Math.min((s?.windSpeed||0)*5,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:"🔽"}),e.jsxs("div",{className:"metric-info",children:[e.jsxs("div",{className:"metric-value-small pressure-value-enhanced",children:[s?.pressure||"--"," hPa"]}),e.jsx("div",{className:"metric-label-small",children:"Pressure"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress pressure-progress",style:{width:`${Math.min((s?.pressure||0)/10,100)}%`}})})]}),e.jsxs("div",{className:"metric-secondary",children:[e.jsx("div",{className:"metric-icon-small",children:I(s?.weatherCondition)}),e.jsxs("div",{className:"metric-info",children:[e.jsx("div",{className:"metric-value-small condition-value-enhanced",children:_(s?.weatherCondition)}),e.jsx("div",{className:"metric-label-small",children:"Conditions"})]}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-progress condition-progress"})})]})]})]}),e.jsxs("div",{className:"weather-footer",children:[e.jsxs("div",{className:"update-info",children:[e.jsx("span",{className:"update-icon",children:"⏱️"}),e.jsxs("span",{className:"update-text",children:["Last updated: ",s?.lastUpdated||"—"]})]}),e.jsx("div",{className:"refresh-info",children:e.jsx("span",{className:"refresh-badge",children:"Auto-refresh: 5 min"})})]})]}),g=s=>{if(!s||s==="00:00")return null;const i=s.split(":");if(i.length<2)return null;const a=parseInt(i[0],10),t=parseInt(i[1],10);return isNaN(a)||isNaN(t)?null:a*60+t},M=(s,i,a)=>{const t=g(s),l=g(i);if(t!==null&&l!==null){let c=l-t;return c<0&&(c+=24*60),Math.max(0,c)/60}return typeof a=="number"&&a>0?a:0},W=(s,i)=>!Array.isArray(s)||s.length===0||!i?0:s.filter(a=>a.date===i).reduce((a,t)=>a+M(t.sleep_onset_time,t.wake_time,t.sleep_duration_h),0),O=({athletes:s,biometricData:i,geneticProfiles:a,onAthleteClick:t})=>{const l=x.useMemo(()=>{const c=(s||[]).map(n=>{const{data:m,genetics:f}=C(n.athlete_id,i,a),p=m&&m.length>0?m[0]:null,b=$(n.athlete_id,m,f),w=m.length>0?D(m[m.length-1]):0,S=p?.date,y=W(m,S);return{athlete:n,latest:p,alert:b,readinessScore:w,computedSleepH:y}}),r=c.filter(n=>n.latest),o=r.length>0?r.reduce((n,m)=>n+(m.latest?.hrv_night||0),0)/r.length:0,d=r.length>0?r.reduce((n,m)=>n+(m.computedSleepH||0),0)/r.length:0,h=r.length>0?r.reduce((n,m)=>n+m.readinessScore,0)/r.length:0,j={high:c.filter(n=>["inflammation","airway"].includes(n.alert.type)).length,medium:c.filter(n=>["circadian","nutrition"].includes(n.alert.type)).length,optimal:c.filter(n=>n.alert.type==="green").length};return{totalAthletes:(s||[]).length,avgHRV:o||0,avgSleep:d||0,avgReadiness:h||0,alertCounts:j,athleteMetrics:c}},[s,i,a]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid-wide",children:[e.jsx(v,{label:"Athletes",value:l.totalAthletes,icon:"👥",color:"blue"}),e.jsx(v,{label:"Avg HRV",value:`${l.avgHRV.toFixed(0)} ms`,icon:"❤️",color:"purple"}),e.jsx(v,{label:"Avg Sleep",value:`${l.avgSleep.toFixed(1)}h`,icon:"😴",color:"indigo"}),e.jsx(v,{label:"Readiness",value:`${l.avgReadiness.toFixed(0)}%`,icon:"⚡",color:"orange"})]}),e.jsxs("div",{className:"alerts-grid",children:[e.jsx(N,{title:"High Priority",count:l.alertCounts.high,icon:"🔴",color:"red",desc:"Immediate attention"}),e.jsx(N,{title:"Monitor",count:l.alertCounts.medium,icon:"🟡",color:"yellow",desc:"Potential issues"}),e.jsx(N,{title:"Optimal",count:l.alertCounts.optimal,icon:"🟢",color:"green",desc:"Ready for training"})]}),e.jsx("section",{className:"athletes-section",children:e.jsx("div",{className:"athletes-grid",children:l.athleteMetrics?.map(({athlete:c,latest:r,alert:o,readinessScore:d,computedSleepH:h},j)=>e.jsxs("div",{className:`athlete-card ${F(o.type)} card-hover`,onClick:()=>t(c.id.toString()),children:[e.jsxs("div",{className:"athlete-header",children:[e.jsxs("div",{className:"athlete-info",children:[e.jsx("h3",{className:"athlete-name",children:c.name}),e.jsxs("p",{className:"athlete-meta",children:[c.sport," • ",c.age," • ",c.team]})]}),e.jsx("div",{className:"alert-icon",children:A(o.type)})]}),e.jsxs("div",{className:"athlete-metrics",children:[e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"HRV"}),e.jsx("span",{className:"value",children:r?.hrv_night?r.hrv_night.toFixed(0)+" ms":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Sleep"}),e.jsx("span",{className:"value",children:h&&h>0?h.toFixed(1)+"h":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"RHR"}),e.jsx("span",{className:"value",children:r?.resting_hr?r.resting_hr.toFixed(0)+" bpm":"N/A"})]}),e.jsxs("div",{className:"metric-pair",children:[e.jsx("span",{className:"label",children:"Ready"}),e.jsxs("span",{className:"value",children:[d.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"athlete-alert",children:[e.jsx("p",{className:"alert-title",children:o.title.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu,"").trim()}),e.jsx("p",{className:"alert-cause",children:o.cause})]}),e.jsx("button",{className:"profile-button",children:"📊 Open Profile"})]},c.id||j))})})]})},v=({label:s,value:i,icon:a,color:t})=>e.jsxs("div",{className:"card-enhanced p-5 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:a}),e.jsx("div",{className:"text-2xl font-bold text-black",children:i}),e.jsx("div",{className:"text-gray-700 text-sm mt-1 font-medium",children:s})]}),N=({title:s,count:i,icon:a,color:t,desc:l})=>e.jsxs("div",{className:`card-enhanced border-${t}-200 bg-${t}-50 p-5 hover:shadow-lg transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:a}),e.jsx("h3",{className:`text-lg font-bold text-${t}-700`,children:s})]}),e.jsx("div",{className:`text-3xl font-bold text-${t}-700 mb-2`,children:i}),e.jsx("p",{className:`text-sm text-${t}-600`,children:l})]}),Y={CITY:{}.VITE_CITY||"Stellenbosch",STATE:{}.VITE_STATE||"Western Cape",COUNTRY:{}.VITE_COUNTRY||"South Africa",REFRESH_INTERVAL:3e5},U=()=>new Date().toLocaleDateString("en-ZA",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),K=()=>{const s=T(),{athletes:i,biometricData:a,geneticProfiles:t,loading:l}=R(!0),{airQuality:c}=V(),r=U(),o=d=>{s(`/athlete/${d}`)};return l?e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsx("div",{className:"main-content",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-white text-2xl",children:"Loading athlete data..."})})})]}):e.jsxs("div",{className:"app-container",children:[e.jsx("div",{className:"background-gradient"}),e.jsx("div",{className:"background-rings"}),e.jsxs("div",{className:"main-content",children:[e.jsxs("header",{className:"header-section",children:[e.jsx("h1",{className:"logo-text",children:e.jsx("img",{src:"/SAMLogo.png",alt:"SAM Recovery Logo",className:"h-8 md:h-10 lg:h-12 w-auto object-contain"})}),e.jsx("p",{className:"tagline",children:"Precision Recovery Through Genetics × Biometrics × Environment"})]}),e.jsx(H,{airQuality:c,city:Y.CITY,formattedDate:r}),e.jsx(O,{athletes:i,biometricData:a,geneticProfiles:t,onAthleteClick:o})]})]})};export{K as TeamOverview};
